---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getBooksByYear } from '../../../lib/books';

export async function getStaticPaths() {
  const years = [2026, 2025];
  return years.map((year) => ({
    params: { year: String(year) },
    props: { year },
  }));
}

const { year } = Astro.props as { year: number };
const books = await getBooksByYear(year);

function stars(n: number) {
  const full = Math.floor(n);
  const half = n % 1 >= 0.5 ? 1 : 0;
  const empty = 5 - full - half;
  return 'â˜…'.repeat(full) + (half ? '<span class="half-star"></span>' : '') + 'â˜†'.repeat(empty);
}

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const asset = (p: string) => `${base}/${p.replace(/^\//, '')}`;
---

<BaseLayout title={`Books in ${year}`}>
  <h1>Books in {year}</h1>

  {books.length === 0 ? (
    <div class="card empty-state">
      <div class="empty-state-icon">ðŸ“š</div>
      <p class="empty-state-text">No books finished yet this year. Time to start reading!</p>
    </div>
  ) : (
    <div style="display:grid; gap: 14px; margin-top: 18px;">
      {books.map((book) => (
        <article class="card book-card">
          <img
            class="cover"
            src={asset(book.data.cover)}
            alt={`Cover of ${book.data.title}`}
            loading="lazy"
          />

          <div>
<div>
            <div style="display: flex; align-items: baseline; gap: 6px; flex-wrap: wrap;">
              <a class="title-link" href={`${base}/reading/books/${book.slug}`}>
                {book.data.title}
              </a>
              <span class="muted" style="font-size: 13px;">by {book.data.author} Â· {book.data.finished}</span>
            </div>

            <div class="stars" set:html={stars(book.data.rating)} />

            <p class="tldr">{book.data.tldr}</p>
          </div>
        </article>
      ))}
    </div>
  )}
</BaseLayout>
