---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getBooksByYear } from '../../lib/books';

export async function getStaticPaths() {
  const years = [2026, 2025];
  return years.map((year) => ({
    params: { year: String(year) },
    props: { year },
  }));
}

const { year } = Astro.props as { year: number };
const books = await getBooksByYear(year);

function stars(n: number) {
  return '★'.repeat(n) + '☆'.repeat(5 - n);
}
---

<BaseLayout title={`Books in ${year}`}>
  <h1>Books in {year}</h1>

  <div style="display: grid; gap: 14px; margin-top: 18px;">
    {books.map((book) => (
      <article class="card" style="display:grid; grid-template-columns:72px 1fr; gap:14px;">
        <img
          src={book.data.cover}
          style="width:72px; height:108px; object-fit:cover; border-radius:10px;"
        />

        <div>
          <a href={`/books/${book.slug}`} style="font-weight:700; text-decoration:none;">
            {book.data.title}
          </a>
          <div class="muted">
            {book.data.author} · {book.data.finished}
          </div>

          <div class="stars">{stars(book.data.rating)}</div>

          <p style="margin-top:8px;">
            {book.data.tldr}
          </p>
        </div>
      </article>
    ))}
  </div>
</BaseLayout>
