---
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const books = await getCollection('books');
  return books.map((book) => ({
    params: { slug: book.slug },
  }));
}

const { slug } = Astro.params;

// Reload the entry inside the page so we get the real Content component
const book = await getEntryBySlug('books', slug!);

if (!book) {
  throw new Error(`Book not found: ${slug}`);
}

const { Content } = await book.render();
---

<html lang="en">
  <body style="font-family: system-ui; padding: 40px; max-width: 860px; margin: 0 auto;">
    <header style="display:flex; gap:16px; align-items:center; margin-bottom: 28px;">
      <a href="/" style="margin-right:auto; font-weight:700; text-decoration:none;">Home</a>
      <a href="/books">Books</a>
      <a href="/recommendations">Recommendations</a>
    </header>

    <h1>{book.data.title}</h1>

    <p>
      <strong>Author:</strong> {book.data.author}<br/>
      <strong>Finished:</strong> {book.data.finished}<br/>
      <strong>Rating:</strong> {book.data.rating}/5
    </p>

    <img
      src={book.data.cover}
      alt={`Cover of ${book.data.title}`}
      style="width:160px; border-radius:12px; margin:16px 0;"
    />

    <h2>TL;DR</h2>
    <p>{book.data.tldr}</p>

    <h2>Full Thoughts</h2>
    <article>
      <Content />
    </article>
  </body>
</html>
